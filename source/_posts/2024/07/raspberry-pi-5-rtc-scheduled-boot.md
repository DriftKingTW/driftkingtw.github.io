---
title: æ¨¹è“æ´¾ 5 é€é RTC è‡ªå‹•å®šæ™‚é–‹æ©Ÿ
tags:
  - NAS
  - Synology
  - DSM
  - Raspberry Pi
keywords:
  - NAS
  - Synology
  - DSM
  - Raspberry Pi
  - RTC
abbrlink: 9bf653c5
date: 2024-12-01 22:00:00
---

![Raspberry Pi RTC Battery (https://www.raspberrypi.com/products/rtc-battery/)](https://static.driftking.tw/2024/12/1cd79caeda0d50c7ea9ad7cfcccd7dd9.webp)

åœ¨ä¸Šä¸€ç¯‡ [é€éæ¨¹è“æ´¾ 5 åŠ ZeroTier å¹« NAS åšç•°åœ°å‚™ä»½](/2024/06/pi-remote-backup-for-synology-nas-using-zerotier/) è¨­å®šå®Œæˆå¾Œï¼Œç«‹åˆ»ç™¼ç¾äº†å€‹å°å•é¡Œï¼šæ¨¹è“æ´¾æœƒéœ€è¦æ•´å¤©é–‹æ©Ÿ~~å·æ‡¶~~ç­‰å¾… NAS çš„å‚™ä»½è«‹æ±‚ï¼Œä½†æˆ‘ä¸€å¤©åªæœ‰è·‘ä¸€æ¬¡å‚™ä»½ç„¶å¾Œä¸€æ¬¡å‚™ä»½æ™‚é–“ä¹Ÿä¸å¤šï¼Œé€™æ¨£è®“æ¨¹è“æ´¾æ•´å¤©é–‹æ©Ÿç„¡æ‰€äº‹äº‹å¯¦åœ¨æœ‰å¤ æµªè²»é›»ï¼Œ~~ç§‰æŒè‘—ç’°ä¿ç²¾ç¥(é›»è²»)~~æ–¼æ˜¯è‘—æ‰‹ç ”ç©¶äº†æœ¬æ¬¡çš„è‡ªå‹•é–‹é—œæ©Ÿçš„æ–¹æ¡ˆã€‚

<!--more-->

é€™æ¬¡ Pi 5 çš„æ›´æ–°åŠ ä¸Šäº† RTC (Real Time Clock)ï¼Œç°¡å–®ä¾†èªª RTC å¯ä»¥è®“è£ç½®åœ¨æ¥µä½åŠŸè€—çš„ç‹€æ…‹ä¸‹ä¿æŒæ™‚é–“åŒæ­¥ä¸¦å¯ä»¥æ‹¿ä¾†æ§åˆ¶å•Ÿå‹•é«˜åŠŸè€—çš„ä¸»è¦è™•ç†å™¨ (åœ¨é€™å€‹æƒ…æ³ä¸‹åªçš„å°±æ˜¯è®“ Pi å¾ Halt ç‹€æ…‹ä¸‹é‡æ–°é–‹æ©Ÿ)ã€‚

RTC æ¨¡çµ„é€šå¸¸æœƒæ¥ä¸Šä¸€å€‹å‚™ç”¨é›»æ± ï¼Œé€™æ¨£å°±å¯ä»¥åœ¨å®Œå…¨ç„¡é›»æºçš„æƒ…æ³ä¹Ÿç¹¼çºŒè®“ RTC æ¨¡çµ„å·¥ä½œã€‚æœ¬æ¬¡æˆ‘å€‘ä¾¿æ˜¯è¦åˆ©ç”¨é€™å€‹åŠŸèƒ½ä¾†å¯¦ä½œè‡ªå‹•é–‹æ©Ÿ ğŸ‘Œ

## æ¸¬è©¦ RTC æ¨¡çµ„è‡ªå‹•å–šé†’åŠŸèƒ½

é¦–å…ˆæˆ‘å€‘è¦å…ˆä¿®æ”¹æ¨¹è“æ´¾çš„ `eeprom` è®“æ©Ÿå™¨åœ¨é€²å…¥ halt ç‹€æ…‹ä¸‹èƒ½é€²å…¥è¶…ä½åŠŸè€—ç‹€æ…‹ï¼Œä¸¦è®“ RTC çš„ `wakealarm` èƒ½å¤ å–šé†’æ¨¹è“æ´¾ï¼š

```shell
sudo -E rpi-eeprom-config --edit
```

åœ¨æ–‡ä»¶åº•éƒ¨æ–°å¢é€™å…©è¡Œè¨­å®šï¼Œåˆ†åˆ¥æ˜¯å•Ÿå‹•ä½åŠŸè€—æ¨¡å¼åŠé—œé–‰ GPIO å–šé†’åŠŸèƒ½ï¼š

```txt
POWER_OFF_ON_HALT=1
WAKE_ON_GPIO=0
```

æ¥è‘—æˆ‘å€‘å°±å¯ä»¥é€éè¨­å®š `wakealarm` ä¾†æ¸¬è©¦æ˜¯å¦å¯ä»¥æˆåŠŸå®šæ™‚è‡ªå‹•æ›é†’ï¼ŒæŒ‡ä»¤ä¸­é€é `date` çš„ `%s` åƒæ•¸å°‡è¨­å®šçš„æ™‚é–“è½‰ç‚ºç§’æ•¸ï¼Œä¸¦è®“ä¸»æ©Ÿåœ¨éäº†è¨­å®šçš„ç§’æ•¸å¾Œè‡ªå‹•é–‹æ©Ÿï¼Œæ‰€ä»¥é€™å€‹ç¯„ä¾‹ä¸­æ¨¹è“æ´¾æ‡‰è©²æœƒåœ¨ 1 åˆ†é˜å¾Œé‡æ–°é–‹æ©Ÿï¼š

{% colorquote info %}
é€é `date` è¨­å®šç›¸ç•¶ç°¡å–®æ˜“æ‡‚ï¼Œç›¸é—œä½¿ç”¨å¯ä»¥åƒè€ƒ [man page](https://man7.org/linux/man-pages/man1/date.1.html)
{% endcolorquote %}

```shell
date -d "+1 minutes" +'%s' | sudo tee /sys/class/rtc/rtc0/wakealarm
sudo halt
```

{% colorquote success %}
RTC æ¨¡çµ„é›–ç„¶æœ‰æä¾›é›»æ± æ¥å£ï¼Œä½†åœ¨ä¸æ‹”é›»æºçš„æƒ…æ³ä¸‹ä¸éœ€è¦é›»æ± ä¹Ÿèƒ½ä½¿ç”¨ RTC åŠŸèƒ½çš„å–”ï¼
{% endcolorquote %}

## æ‡‰ç”¨å¯¦ä¾‹

åˆ°é€™é‚Šå·²ç¶“çŸ¥é“å¦‚ä½•è¨­å®šè‡ªå‹•é–‹æ©Ÿäº†ï¼Œæ¥è‘—å°±æ˜¯ä»»å‹™å®Œæˆå¾Œè¦è®“æ¨¹è“æ´¾è‡ªå‹•é—œæ©Ÿã€‚ç”±æ–¼é€™éƒ¨ä»½æ¯å€‹äººä½¿ç”¨çš„æƒ…æ³å¯èƒ½ä¹Ÿä¸ç›¡ç›¸åŒï¼Œæˆ‘é€™é‚Šæä¾›è‡ªå·±çš„ NAS å‚™ä»½æ¡ˆä¾‹ä¾†èªªæ˜ï¼š

### é–‹æ©Ÿé‚è¼¯

é¦–å…ˆå‡è¨­æˆ‘åœ¨ NAS ç«¯çš„è¨­å®šæ˜¯æ¯å¤©å‡Œæ™¨å…©é»è‡ªå‹•å‚™ä»½åˆ°æ¨¹è“æ´¾ä¸Šï¼Œé‚£éº¼é€™é‚Šå°±éœ€è¦è®“æ¨¹è“æ´¾åœ¨æ¯å¤©å››é»å‰å…ˆè‡ªå‹•é–‹æ©Ÿç­‰å¾…å‚™ä»½è«‹æ±‚ï¼Œä¸¦åµæ¸¬åˆ°å‚™ä»½å®Œæˆå¾Œè¨­å®šä¸‹ä¸€æ¬¡é–‹æ©Ÿæ™‚é–“ä¸¦è‡ªå‹•é—œæ©Ÿã€‚

æ­¤æ™‚æˆ‘çš„ `wakealarm` è¨­å®šæ˜å¤©çš„å‡Œæ™¨ 1:50 å•Ÿå‹•ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š

```shell
date -d "+tomorrow 1:50" +'%s' > /sys/class/rtc/rtc0/wakealarm
```

### é—œæ©Ÿé‚è¼¯

ç”±æ–¼éœ€è¦åµæ¸¬ NAS é‚£é‚Šæ˜¯å¦å‚™ä»½å®Œæˆï¼Œåœ¨ç¶“éä¸€ç•ªæœå°‹ä¹‹å¾Œæ±ºå®šä½¿ç”¨ [N4S4](https://github.com/N4S4) æä¾›çš„ [synology-api](https://github.com/N4S4/synology-api) ä¾†å¯¦ä½œå‚™ä»½é€²åº¦çš„æª¢æ¸¬ã€‚

ç°¡å–®ä¾†èªªæˆ‘æ˜¯é€é API åœ¨æ¯å¤©è¨­å®šçš„å‚™ä»½æ™‚é–“é 30 åˆ†é˜å¾Œï¼Œè‡ªå‹•åŸ·è¡Œä¸€å€‹ Python Script å»ç™¼è«‹æ±‚æª¢æŸ¥ `HyperBackup` çš„å‚™ä»½é€²åº¦ï¼Œå¦‚æœå®Œæˆå°±è¨­å®š `wakealarm` ä¸¦é—œæ©Ÿï¼Œå¦‚æœé‚„æœªå®Œæˆå°±æ¯ 30 ç§’è©¢å•é€²åº¦ç›´åˆ°å‚™ä»½å®Œæˆã€‚

ç”±æ–¼æ­¤è…³æœ¬ä¸æ˜¯æœ¬ç¯‡é‡é»å°±ä¸ç´°èªªï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥ç›´æ¥åƒè€ƒæˆ–ä½¿ç”¨æˆ‘æ‰€å¯«çš„è…³æœ¬ï¼š[pi-backup-power-scheduler](https://github.com/DriftKingTW/pi-backup-power-scheduler) è£¡é¢æœ‰æä¾›ä½¿ç”¨èªªæ˜åŠè¨­å®šæ–¹å¼ã„›ï¼

## åƒè€ƒ

[Buy a Raspberry Pi RTC Battery - Raspberry Pi](https://www.raspberrypi.com/products/rtc-battery/)

[Raspberry Pi hardware - Raspberry Pi Documentation # Real Time Clock (RTC)](https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#real-time-clock-rtc)

[synology-api](https://github.com/N4S4/synology-api)
